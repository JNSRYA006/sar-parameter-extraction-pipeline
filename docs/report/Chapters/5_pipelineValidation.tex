%****************************************************
%	CHAPTER 5 - PIPELINE VALIDATION EXPERIMENTS
%****************************************************
\chapter{Pipeline Verification Experiments}
\label{chap:pipelineValidation}
%====================================================

\section{\acs{sar} Data Transects} \label{sec:pipelineVal.transects}

As mentioned in Section \ref{subsec:systemDesign.preProcessing.transects}, the ability to take transects of full scene \acs{sar} data is vital to follow the changes in wave spectra over a full scene. In order to quantitatively measure the difference between taken transects obtained using the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/preprocess/get512Transects.m}{\lstinline{get512Transects}} function, the \ac{mse} of all transects' pixels was calculated using the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/preprocess/get512Transects.m}{\lstinline{transectMSE}} function.

Transects which were the same resulted in a \acs{mse} equal to 0, and the larger the \acs{mse}, the more the transects differ. Due to the fact that the transects are intensity data obtained by \acs{s1a}, it cannot be expected that the transects are completely different to one another at each pixel of the transect data. The code given in Listing \ref{code:pipelineVal.mse} was run for the 3 transects shown in Figure \ref{fig:systemDesign.transects} and the output structure is shown below in Table \ref{tab:pipelineVal.mse}.

\begin{lstlisting}[caption={\textsc{Matlab} code used to calculate MSE values between all transects taken in Figure \ref{fig:systemDesign.transects}.},label={code:pipelineVal.mse}]
transectMSEStruct = transectMSE(transectData);
\end{lstlisting}


\begin{table}[H]
\centering
\begin{tabular}{|l|r|}
\hline
\multicolumn{1}{|c|}{\textbf{Transects}} & \multicolumn{1}{c|}{\textbf{\acs{mse}}} \\ \hline
Transect 1 vs. Transect 1 & 0 \\ \hline
Transect 1 vs. Transect 2 & 136.3483 \\ \hline
Transect 1 vs. Transect 3 & 384.8439 \\ \hline
Transect 2 vs. Transect 1 & 136.3483 \\ \hline
Transect 2 vs. Transect 2 & 0 \\ \hline
Transect 2 vs. Transect 3 & 362.1531 \\ \hline
Transect 3 vs. Transect 1 & 384.8439 \\ \hline
Transect 3 vs. Transect 2 & 362.1531 \\ \hline
Transect 3 vs. Transect 3 & 0 \\ \hline
\end{tabular}
\caption{\lstinline{transectMSEStruct} value after running Listing \ref{code:pipelineVal.mse}. The \acs{mse} when comparing the same transects is equal to 0, whereas, when comparing different transects, a higher \acs{mse} is obtained.}
\label{tab:pipelineVal.mse}
\end{table}

Table \ref{tab:pipelineVal.mse} confirms the expected result that identical transects return a \acs{mse} of 0 whilst different transects return a high \acs{mse} value. This verifies the uniqueness of the \acs{sar} data transects obtained using \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/preprocess/get512Transects.m}{\lstinline{get512Transects}}.

\section{Wave Spectra} \label{sec:pipelineVal.waveSpectra}

\subsection{Wave Data Download} \label{subsec:pipelineVal.waveDataDownload}

Whilst not entirely necessary, it is useful to visualise the downloaded wave data from \acs{ncep} in order to verify that the extracted parameters correspond to the correct, sensible values. I.e, when plotting significant wave height, values should be within an acceptable range and not the incorrect type (wave direction, for example). All of these data were plotted using the M\_Map package.

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.48\linewidth}
        \centering
        \includegraphics[width=\linewidth]{Figures/PipelineValidation/noaamillersignificantWaveHeight.pdf}
        \caption{Significant wave height.}
        \label{fig:pipelineVal.waveDataPlot.height}
    \end{subfigure}   
    \begin{subfigure}{0.48\linewidth}
        \centering
        \includegraphics[width=\linewidth]{Figures/PipelineValidation/noaamillersignificantWavePeriod.pdf}
        \caption{Significant wave period.}
        \label{fig:pipelineVal.waveDataPlot.period}
    \end{subfigure}   
    \begin{subfigure}{0.48\linewidth}
        \centering
        \includegraphics[width=\linewidth]{Figures/PipelineValidation/noaamillerdirection.pdf}
        \caption{Wave direction.}
        \label{fig:pipelineVal.waveDataPlot.direction}
    \end{subfigure}
    \begin{subfigure}{0.48\linewidth}
        \centering
        \includegraphics[width=\linewidth]{Figures/PipelineValidation/noaamillerwindDirection.pdf}
        \caption{Wind direction.}
        \label{fig:pipelineVal.waveDataPlot.windDirection}
    \end{subfigure}           
    \begin{subfigure}{0.48\linewidth}
        \centering
        \includegraphics[width=\linewidth]{Figures/PipelineValidation/noaamillerwindSpeed.pdf}
        \caption{Wind speed.}
        \label{fig:pipelineVal.waveDataPlot.windSpeed}
    \end{subfigure}       
    \caption{M\_Map plots using Miller projection of various \acs{ncep} wave data parameters from 02-Oct-2023.}
    \label{fig:pipelineVal.waveDataPlot}
\end{figure}

Figures \ref{fig:pipelineVal.waveDataPlot.direction}, \ref{fig:pipelineVal.waveDataPlot.windDirection} both vary between 0 and 360$\degree$ which verifies that these data are correctly extracted. In terms of agreement within acceptable ranges for Figures \ref{fig:pipelineVal.waveDataPlot.height}, \ref{fig:pipelineVal.waveDataPlot.period}, \ref{fig:pipelineVal.waveDataPlot.windSpeed}, these range of these data makes sense. Therefore, the downloaded \acs{ncep} wave data, as well as both the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/preprocess/get512Transects.m}{\lstinline{downloadNOAAWaveFile}} and \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/preprocess/get512Transects.m}{\lstinline{getGribStruct}} functions are implemented correctly.

\subsection{Wave Evolution} \label{subsec:pipelineVal.waveSpectra.waveEvolution}
%% Check holthuisjen expected changes are correct

In order to verify the way in which one-dimensional \acs{jonswap} wave spectra are constructed, it is essential to verify that the expected behaviour of waves when entering shallower water is met. As the depth of water decreases, the peak frequency of the wave is expected to decrease according to Equation \ref{eq:linearWaveTheory.dispersionRelationship.shallowWater}, as an increase in depth increases the $\omega_{peak}$ value. The height of the wave is expected to decrease due to the change in orbital motion of waves due to depth, as detailed in Chapter 5.4.2 of \cite{Holthuijsen2007}. 

To see these changes, geographic coordinates surrounding the Cape Point directional buoy were chosen. These coordinates were generated using the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/waveSpectra/generateSingleJONSWAP.m}{\lstinline{createLatLonGrid}} function and the resulting coordinates are shown in Listing \ref{code:latLonExtract.grid}. However, due to the spatial resolution of 0.25$\degree$ provided by \acs{ncep} wave data, these points are not useful when validating the generation of the wave model. All of the individual points used to generate wave spectra are shown in Figure \ref{fig:pipelineVal.1DWaveSpectrum.map} along with the location of the \acs{csir} directional wave buoy. 

It is important to note that some points in Figure \ref{fig:pipelineVal.1DWaveSpectrum.map} do not aid the verification of generating accurate \acs{jonswap} spectra. The reasons why these are not suitable are discussed in Table \ref{tab:pipelineVal.1DWaveSpectrum.invalidLocs}.

\begin{table}[H]
\centering
\begin{tabular}{|c|c|c|}
\hline
\textbf{Figure \ref{fig:pipelineVal.1DWaveSpectrum.map} Label} & \textbf{Location ($\degree$)} & \textbf{Reason} \\ \hline
WS 1\_3 (34S, 18.5E) & 34$\degree$\,S, 18.5$\degree$\,E & \begin{tabular}[c]{@{}c@{}}Data point located on land,\\ as opposed to the ocean.\end{tabular} \\ \hline
WS 2\_3 (34.25S, 18.5E) & 34.25$\degree$\,S, 18.5$\degree$\,E & \begin{tabular}[c]{@{}c@{}}Data point located in  False Bay\\ (East of Cape Point), as opposed to being\\ West of Cape Point peninsula.\end{tabular} \\ \hline
WS 3\_3 (34.5S, 18.5E) & 34.5$\degree$\,S, 18.5$\degree$\,E & No significant change in depth. \\ \hline
\end{tabular}
\caption{Data points generated by the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/waveSpectra/generateSingleJONSWAP.m}{\lstinline{createLatLonGrid}} function not used to verify wave evolution over space.}
\label{tab:pipelineVal.1DWaveSpectrum.invalidLocs}
\end{table}


% Cite google earth pro and https://www.opendem.info/download_bathymetry.html
% Change labels to include lat and long
\begin{figure}[H]
    \centering
    \includegraphics[width=.95\linewidth]{Figures/PipelineValidation/GoogleEarthWaveLocationsContoursGrid.pdf}
    \caption{Geographic points of generated \acs{jonswap} spectra using \acs{ncep} wave data. The location of the \acs{csir} directional wave buoy is shown. The points indicating each wave spectrum location correspond to the colours of the plots generated in Figure \ref{fig:pipelineVal.1DWaveSpectrum.all}. The contours shown in colour represent the respective depths below sea level: \textcolor{25m}{25\,m}, \textcolor{50m}{50\,m}, \textcolor{100m}{100\,m}, \textcolor{200m}{200\,m}, \textcolor{250m}{250\,m}, \textcolor{500m}{500\,m}, and \textcolor{750m}{750\,m}. Bathymetric contour data sourced and adapted from xx.}
    \label{fig:pipelineVal.1DWaveSpectrum.map}
\end{figure}

The wave spectra in Figure \ref{fig:pipelineVal.1DWaveSpectrum.all} can be seen to vary for different geographical locations. Examining each individual plot in Figures \ref{fig:pipelineVal.1DWaveSpectrum.1}, \ref{fig:pipelineVal.1DWaveSpectrum.2}, \ref{fig:pipelineVal.1DWaveSpectrum.3} allows the effect of change in depth to be determined, and verified.

\begin{figure}[H]
    \centering
    \subcaptionbox{\acs{jonswap} spectrum over three distinct latitudes and longitudes obtained from \acs{ncep} wave data. Wave spectra at the same latitude are shown in the same colour whilst the longitude of the wave spectra change.\label{fig:pipelineVal.1DWaveSpectrum.all}}[0.48\linewidth]{
        \resizebox{\linewidth}{!}{\input{Figures/PipelineValidation/valWaveSpec_toShore}}
    }
    \subcaptionbox{\acs{jonswap} spectrum at a constant latitude, 34$\degree$\,S, and varying longitudes.\label{fig:pipelineVal.1DWaveSpectrum.1}}[0.48\linewidth]{
        \resizebox{\linewidth}{!}{\input{Figures/PipelineValidation/valWaveSpec_toShore_1}}
    }
    \subcaptionbox{\acs{jonswap} spectrum at a constant latitude, 34.25$\degree$\,S, and varying longitudes.\label{fig:pipelineVal.1DWaveSpectrum.2}}[0.48\linewidth]{
        \resizebox{\linewidth}{!}{\input{Figures/PipelineValidation/valWaveSpec_toShore_2}}
    }    
    \subcaptionbox{\acs{jonswap} spectrum at a constant latitude, 34.5$\degree$\,S, and varying longitudes.\label{fig:pipelineVal.1DWaveSpectrum.3}}[0.48\linewidth]{
        \resizebox{\linewidth}{!}{\input{Figures/PipelineValidation/valWaveSpec_toShore_3}}
    }    
    \caption{One-dimensional \acs{jonswap} wave spectra, E($\omega$), which change over different geographical locations surrounding the \acs{csir} Cape Point wave buoy located at $34.20400000\degree$\,S, $18.28666944\degree$\,E. Generated using \acs{ncep} wave data.}
    \label{fig:pipelineVal.1DWaveSpectrum}
\end{figure}

As the wave spectrum at 34$\degree$\,S moves from 18$\degree$\,E to 18.25$\degree$\,E in Figure \ref{fig:pipelineVal.1DWaveSpectrum.1}, the depth of the sea floor changes from approximately 200\,m to 100\,m as per the contour lines in Figure \ref{fig:pipelineVal.1DWaveSpectrum.map}. As the depth changes, the location of the peak wave frequency, $\omega_{peak}$, increases from 1.894\,rad/s to 2.336\,rad/s. This matches the relationship as defined in Equation \ref{eq:linearWaveTheory.dispersionRelationship.shallowWater} as a decrease in depth results in an increase in $\omega_{peak}$. The wave height in \ref{fig:pipelineVal.1DWaveSpectrum.1} decreases from 1.74E-2\,m$^2$/rad/Hz to 0.77E-2\,m$^2$/rad/Hz. This matches the change in the orbital motion of waves due to depth, as detailed in Chapter 5.4.2 of \cite{Holthuijsen2007}. 

The same observations can be made for the wave spectra at 34.25$\degree$\,S and 34.5$\degree$\,S seen in Figures \ref{fig:pipelineVal.1DWaveSpectrum.2} and \ref{fig:pipelineVal.1DWaveSpectrum.3} respectively as they both change from 18$\degree$\,E to 18.25$\degree$\,E. The respective change in depth from the contour lines in Figure \ref{fig:pipelineVal.1DWaveSpectrum.map}, as explained above, verifies the output wave spectra generated in \ref{fig:pipelineVal.1DWaveSpectrum.all}. Therefore, both the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/waveSpectra/generateSingleJONSWAP.m}{\lstinline{generateSingleJONSWAP}} and \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/waveSpectra/generateMultipleJONSWAP.m}{\lstinline{generateMultipleJONSWAP}} functions were implemented correctly. Furthermore, the closest geographical point to the \acs{csir} wave buoy seen in Figure \ref{fig:pipelineVal.1DWaveSpectrum.map} is WS 2\_2(34.25S, 18.25E). Therefore, for the rest of this report, this location will be used as an approximation of the wave spectrum at the \acs{csir} Cape Point directional wave buoy.

\subsection{Deep Water Approximation} \label{subsec:pipelineVal.waveSpectra.deepWater}

Equation \ref{eq:addingTwoWaves.groupVelocity} details the relation between wave group and individual wave's phase velocities. Per \cite{Holthuijsen2007}, for deep water, this value should equal 0.5. In order to verify whether deep water assumptions hold for the location of the \acs{csir} directional wave buoy at a depth of 70\,m, the value of n should be equal to 0.5. This process was done using the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/waveSpectra/generateMultipleJONSWAP.m}{\lstinline{nValidation}} plotting function, which took in the wave number, depth, and the step between depth values to plot. 

\begin{figure}[H]
    \centering
    \resizebox{0.48\linewidth}{!}{\input{Figures/PipelineValidation/nValidation}}
    \caption{Plot generated using the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/waveSpectra/generateMultipleJONSWAP.m}{\lstinline{nValidation}} function for varying depths using Equation \ref{eq:addingTwoWaves.n}.}
    \label{fig:pipelineVal.nVal}
\end{figure}

Figure \ref{fig:pipelineVal.nVal} shows that after the dispersion relation, n gets to within 10\,\% of 0.5 at a depth of 45\,m and at 70\,m depth has a value of 0.5041. Therefore, the calculation of the n value was correct and deep water assumptions hold for calculations moving forward. Furthermore, this allows the group wave velocities to be accurately calculated, and as a result, the conversion between directional wave spectra and wave-number spectra using Equation \ref{eq:waveNumberSpectrum.relateE(kx,ky)toE(w,th)_2D} can be accurately performed.

\subsection{Negative $\mathbf{k}$ Wave-number Spectra} \label{subsec:pipelineVal.waveSpecta.invK}

The inverse wave-number spectrum, $E(-\underline{k})$, is required by Equations \ref{eq:hh.var.fR}, \ref{eq:hh.var.fRv} in order to compute the respective co- and autocovariance functions required for the \acs{sar} imaging of ocean waves. In order to verify that this spectrum is correctly generated, plots of both the original and inverse wave-number spectra were compared. The inverse value of $k$ was calculated as \lstinline{k_inv = -k;}. The geometry to determine the $x$ and $y$ components of \lstinline{k_inv} can be found in Section \ref{subsec:theory.waves.waveNumberSpectra.2D}.

\begin{figure}[H]
    \centering
    \subcaptionbox{Two-dimensional wave-number \acs{jonswap} spectrum, $E(\underline{k})$.\label{fig:pipelineVal.1DWaveSpectrumInv.Ek}}[0.48\linewidth]{
        \resizebox{\linewidth}{!}{\input{Figures/PipelineValidation/Valcontour_E_k}}
    }
    \subcaptionbox{Two-dimensional inverse wave-number \acs{jonswap} spectrum, $E(-\underline{k})$.\label{fig:pipelineVal.1DWaveSpectrumInv.Ek_inv}}[0.48\linewidth]{
        \resizebox{\linewidth}{!}{\input{Figures/PipelineValidation/Valcontour_E_k_inv}}
    }
    \caption{Comparison of $E(\underline{k})$ and $E(-\underline{k})$, from 02-Oct-2023 at 34$\degree$\,S, 18$\degree$\,E. Generated using \acs{ncep} wave data and the \href{https://github.com/JNSRYA006/sar-parameter-extraction-pipeline/blob/main/functions/waveSpectra/waveNumberSpectrum.m}{\lstinline{waveNumberSpectrum}} function.}
    \label{fig:pipelineVal.1DWaveSpectrumInv}
\end{figure}

Figure \ref{fig:pipelineVal.1DWaveSpectrumInv} shows a side by side comparison of both $E(\underline{k})$ and $E(-\underline{k})$. It can be seen that determining the inverse wave-number spectrum, $E(-\underline{k})$, results in a 'flipped' plot. This plot in Figure \ref{fig:pipelineVal.1DWaveSpectrumInv.Ek_inv} is identical to the plot in Figure \ref{fig:pipelineVal.1DWaveSpectrumInv.Ek}, however, is defined over the negative $k_x$ and $k_y$ axes of those in Figure \ref{fig:pipelineVal.1DWaveSpectrumInv.Ek}. This represents a 180$\degree$ rotation about the $z$-axis of Figure \ref{fig:pipelineVal.1DWaveSpectrumInv.Ek} and is the desired result. Therefore, the generation of an inverse wave-number spectrum can be verified as correct.


\section{\acs{sar} Spectra of Ocean Waves} \label{sec:pipelineVal.sarSpectra}

\subsection{Quasi-linear Coefficient} \label{subsec:pipelineVal.sarSpectra.qlCoeff}


\subsubsection{$\mathbf{k_x}$ Cut-off} \label{subsec:pipelineVal.sarSpectra.kxCutoff}

\subsection{Power Spectral Expansions} \label{subsec:pipelineVal.sarSpectra.powerSpectra}

\subsubsection{$\mathbf{P^S_{n,2n}}$}

\subsubsection{$\mathbf{P^S_{n,2n-1}}$}

\subsubsection{$\mathbf{P^S_{n,2n-2}}$}



\section{Inversion} \label{sec:pipelineVal.inversion}



\section{Results} \label{sec:pipelineVal.results}





%****************************************************
% END
%****************************************************
